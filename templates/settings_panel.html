<div id="openvault_settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>OpenVault</b>
            <span id="openvault_status" class="openvault-status ready">Ready</span>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- Main Controls -->
            <div class="openvault-section">
                <label class="checkbox_label">
                    <input type="checkbox" id="openvault_enabled" checked />
                    <span>Enable OpenVault</span>
                </label>
                <label class="checkbox_label">
                    <input type="checkbox" id="openvault_automatic" checked />
                    <span>Automatic Mode</span>
                    <small class="openvault-hint">(Retrieve before AI, extract after AI every N messages)</small>
                </label>
            </div>

            <!-- Manual Actions -->
            <div class="openvault-section">
                <h4>Manual Actions</h4>
                <div class="openvault-button-row">
                    <button id="openvault_extract_btn" class="menu_button">
                        <i class="fa-solid fa-brain"></i> Extract Memories
                    </button>
                    <button id="openvault_retrieve_btn" class="menu_button">
                        <i class="fa-solid fa-search"></i> Retrieve Context
                    </button>
                </div>
                <button id="openvault_extract_all_btn" class="menu_button wide">
                    <i class="fa-solid fa-layer-group"></i> Backfill Chat History
                </button>
            </div>

            <!-- Settings -->
            <div class="openvault-section">
                <h4>Settings</h4>

                <label for="openvault_extraction_profile">Extraction Profile</label>
                <select id="openvault_extraction_profile" class="text_pole">
                    <option value="">Use current connection</option>
                </select>
                <small class="openvault-hint">LLM profile used for memory extraction (quality summaries)</small>

                <label for="openvault_retrieval_profile">Retrieval Profile</label>
                <select id="openvault_retrieval_profile" class="text_pole">
                    <option value="">Use current connection</option>
                </select>
                <small class="openvault-hint">LLM profile used for smart retrieval (can use faster model)</small>

                <label for="openvault_token_budget">
                    Token Budget: <span id="openvault_token_budget_value">1000</span>
                </label>
                <input type="range" id="openvault_token_budget" min="200" max="30000" step="100" value="1000" />
                <small class="openvault-hint">Maximum tokens for injected context</small>

                <label for="openvault_messages_per_extraction">
                    Messages per Extraction: <span id="openvault_messages_per_extraction_value">10</span>
                </label>
                <input type="range" id="openvault_messages_per_extraction" min="1" max="50" step="1" value="10" />
                <small class="openvault-hint">Number of messages to analyze when extracting memories</small>

                <label for="openvault_memory_context_count">
                    Memory Context: <span id="openvault_memory_context_count_value">All</span>
                </label>
                <input type="range" id="openvault_memory_context_count" min="-1" max="200" step="1" value="-1" />
                <small class="openvault-hint">Include memories in extraction for consistency (-1 = All, 0 = none)</small>

                <label class="checkbox_label">
                    <input type="checkbox" id="openvault_smart_retrieval" checked />
                    <span>Smart Retrieval Mode</span>
                    <small class="openvault-hint">(Use LLM to select most relevant memories)</small>
                </label>

                <label for="openvault_max_memories">
                    Max Memories per Retrieval: <span id="openvault_max_memories_value">100</span>
                </label>
                <input type="range" id="openvault_max_memories" min="5" max="200" step="5" value="100" />
                <small class="openvault-hint">Maximum memories LLM can select from during smart retrieval</small>

                <label class="checkbox_label">
                    <input type="checkbox" id="openvault_auto_hide" checked />
                    <span>Auto-hide old messages</span>
                    <small class="openvault-hint">(Hide messages beyond threshold, memories still injected)</small>
                </label>

                <label for="openvault_auto_hide_threshold">
                    Messages to keep visible: <span id="openvault_auto_hide_threshold_value">50</span>
                </label>
                <input type="range" id="openvault_auto_hide_threshold" min="10" max="200" step="2" value="50" />
                <small class="openvault-hint">Messages older than this are hidden (in pairs)</small>

                <label for="openvault_backfill_rpm">Backfill Rate Limit (RPM)</label>
                <input type="number" id="openvault_backfill_rpm" class="text_pole" min="1" max="600" value="30" />
                <small class="openvault-hint">Max requests per minute during backfill (lower = safer for rate limits)</small>
            </div>

            <!-- Statistics -->
            <div class="openvault-section">
                <h4>Statistics</h4>
                <div class="openvault-stats">
                    <div class="openvault-stat">
                        <span class="openvault-stat-value" id="openvault_stat_events">--</span>
                        <span class="openvault-stat-label">Events</span>
                    </div>
                    <div class="openvault-stat">
                        <span class="openvault-stat-value" id="openvault_stat_characters">--</span>
                        <span class="openvault-stat-label">Characters</span>
                    </div>
                    <div class="openvault-stat">
                        <span class="openvault-stat-value" id="openvault_stat_relationships">--</span>
                        <span class="openvault-stat-label">Relationships</span>
                    </div>
                </div>
                <!-- Batch Processing Info -->
                <div class="openvault-batch-info">
                    <div class="openvault-batch-row">
                        <span class="openvault-batch-label">Messages:</span>
                        <span class="openvault-batch-value" id="openvault_batch_messages">--</span>
                    </div>
                    <div class="openvault-batch-row">
                        <span class="openvault-batch-label">Extracted:</span>
                        <span class="openvault-batch-value" id="openvault_batch_processed">--</span>
                    </div>
                    <div class="openvault-batch-row">
                        <span class="openvault-batch-label">Backfill:</span>
                        <span class="openvault-batch-value" id="openvault_batch_status">--</span>
                    </div>
                    <div class="openvault-batch-row">
                        <span class="openvault-batch-label">Next auto:</span>
                        <span class="openvault-batch-value" id="openvault_batch_next">--</span>
                    </div>
                </div>
                <button id="openvault_refresh_stats_btn" class="menu_button">
                    <i class="fa-solid fa-refresh"></i> Refresh Stats
                </button>
            </div>

            <!-- Memory Browser (collapsed by default) -->
            <div class="openvault-section">
                <div class="inline-drawer">
                    <div class="inline-drawer-toggle inline-drawer-header">
                        <span>Memory Browser</span>
                        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
                    </div>
                    <div class="inline-drawer-content">
                        <div class="openvault-filters">
                            <select id="openvault_filter_type" class="text_pole">
                                <option value="">All Types</option>
                                <option value="action">Actions</option>
                                <option value="revelation">Revelations</option>
                                <option value="emotion_shift">Emotion Shifts</option>
                                <option value="relationship_change">Relationship Changes</option>
                            </select>
                            <select id="openvault_filter_character" class="text_pole">
                                <option value="">All Characters</option>
                            </select>
                        </div>
                        <div id="openvault_memory_list" class="openvault-memory-list">
                            <p class="openvault-placeholder">No memories yet</p>
                        </div>
                        <div class="openvault-pagination">
                            <button id="openvault_prev_page" class="menu_button" disabled>
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <span id="openvault_page_info">Page 1</span>
                            <button id="openvault_next_page" class="menu_button" disabled>
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Character States (collapsed by default) -->
            <div class="openvault-section">
                <div class="inline-drawer">
                    <div class="inline-drawer-toggle inline-drawer-header">
                        <span>Character States</span>
                        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
                    </div>
                    <div class="inline-drawer-content">
                        <div id="openvault_character_states" class="openvault-character-list">
                            <p class="openvault-placeholder">No character data yet</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relationships (collapsed by default) -->
            <div class="openvault-section">
                <div class="inline-drawer">
                    <div class="inline-drawer-toggle inline-drawer-header">
                        <span>Relationships</span>
                        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
                    </div>
                    <div class="inline-drawer-content">
                        <div id="openvault_relationships" class="openvault-relationship-list">
                            <p class="openvault-placeholder">No relationship data yet</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug -->
            <div class="openvault-section">
                <label class="checkbox_label">
                    <input type="checkbox" id="openvault_debug" />
                    <span>Debug Mode</span>
                </label>
            </div>

            <!-- Danger Zone -->
            <div class="openvault-section openvault-danger">
                <div class="inline-drawer">
                    <div class="inline-drawer-toggle inline-drawer-header">
                        <span>Danger Zone</span>
                        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
                    </div>
                    <div class="inline-drawer-content">
                        <button id="openvault_delete_chat_btn" class="menu_button danger">
                            <i class="fa-solid fa-trash"></i> Delete Current Chat Memories
                        </button>
                        <button id="openvault_delete_all_btn" class="menu_button danger">
                            <i class="fa-solid fa-bomb"></i> Delete All Data
                        </button>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="openvault-footer">
                <small>OpenVault v0.2.0 - Free & Open Source Agentic Memory</small>
            </div>
        </div>
    </div>
</div>
