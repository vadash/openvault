/* eslint-disable no-control-regex, no-useless-escape */
/* esm.sh - @toolsycc/json-repair@0.1.22 */
var b=Object.create;var u=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var O=(l,r)=>()=>(r||l((r={exports:{}}).exports,r),r.exports);var $=(l,r,n,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of h(r))!S.call(l,t)&&t!==n&&u(l,t,{get:()=>r[t],enumerable:!(e=p(r,t))||e.enumerable});return l};var J=(l,r,n)=>(n=l!=null?b(x(l)):{},$(r||!l||!l.__esModule?u(n,"default",{value:l,enumerable:!0}):n,l));var m=O(o=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0});o.extractJsonFromText=d;o.repairJson=y;function d(l){let r=l.trim().replace(/^```json\s*/i,"").replace(/```$/,"").trim(),n=r.indexOf("{"),e=r.indexOf("["),t=n>=0&&(n<e||e===-1)?n:e;if(t===-1)return l;let s=[],i=t;for(let c=t;c<r.length;c++){let a=r[c];if(a==="{"||a==="[")s.push(a);else if(a==="}"||a==="]"){let f=s.pop();if(!f||a==="}"&&f!=="{"||a==="]"&&f!=="[")break;if(s.length===0){i=c+1;break}}}return r.substring(t,i)}function N(l){return l.split(`
`).map(r=>{let n=r.indexOf("{"),e=r.lastIndexOf("}");if(n===-1||e===-1||n>=e||r.includes(","))return r;let t=r.slice(n+1,e),s=t.indexOf(":");if(s===-1)return r;let i=t.slice(0,s).trim(),c=t.slice(s+1).trim();return c.includes('"')&&(c.startsWith('"')||(c='"'+c),c.endsWith('"')||(c=c+'"'),c=c.slice(1,-1).replace(/(?<!\\)"/g,'\\"'),c='"'+c+'"'),`{${i}: ${c}}`}).join(`
`)}function j(l){return l.replace(/"([^"\n\\]*?)"/g,(r,n)=>/[^\\]"/.test(n)?`"${n.replace(/([^\\])"/g,'$1\\"')}"`:r)}function k(l){let r=0,n=0,e=[...l];for(let s=0;s<e.length;s++){let i=e[s];i==="{"?r++:i==="}"?r>0?r--:e[s]="":i==="["?n++:i==="]"&&(n>0?n--:e[s]="")}let t=e.join("");return r>0&&(t+="}".repeat(r)),n>0&&(t+="]".repeat(n)),t}function v(l){let r=!1,n=!1,e=[...l];for(let t=0;t<e.length;t++){let s=e[t];s==='"'&&!n?(r=!r,n=!1):s==="\\"&&!n?n=!0:(r&&(s===`
`?e[t]="\\n":s==="\r"?e[t]="\\r":s==="	"&&(e[t]="\\t")),n=!1)}return e.join("")}function w(l){let r=[...l.matchAll(/\/\/.*/g)],n=l;for(let e=r.length-1;e>=0;e--){let t=r[e],s=t.index,i=t[0];if(i.includes("}")){let c=i.indexOf("}"),a=i.substring(c);n=n.substring(0,s)+a+n.substring(s+i.length)}}return n}function y(l,r={}){try{let n=JSON.parse(l);if(!r.returnObject){let e=JSON.stringify(n);return r.encodeAscii&&(e=e.replace(/[^\x00-\x7F]/g,t=>"\\u"+t.charCodeAt(0).toString(16).padStart(4,"0"))),e}return n}catch(n){r.logging&&(console.warn("JSON.parse failed:",n),console.warn("Trying to repair JSON..."));let e=l;r.extractJson&&(e=d(e),r.logging&&console.log("Extracted JSON block:",e)),e=w(e),r.logging&&console.log("Handled comments with unmatched braces:",e),e=e.replace(/\/\/.*|\/\*[\s\S]*?\*\//g,""),r.logging&&console.log("Removed remaining comments:",e),e=e.replace(/,\s*([\]}])/g,"$1"),r.logging&&console.log("Removed trailing commas:",e),e=e.replace(/([{,]\s*)([a-zA-Z_][a-zA-Z0-9_]*)(\s*:)/g,'$1"$2"$3'),r.logging&&console.log("Quoted keys:",e),e=e.replace(/'([^']*)'/g,'"$1"'),r.logging&&console.log("Converted single to double quotes:",e),e=e.replace(/\b(NaN|undefined|Infinity|-Infinity)\b/g,"null"),r.logging&&console.log("Replaced invalid literals:",e),e=e.replace(/\bTrue\b/g,"true").replace(/\bTRUE\b/g,"true").replace(/\bFalse\b/g,"false").replace(/\bFALSE\b/g,"false").replace(/\bNull\b/g,"null").replace(/\bNULL\b/g,"null"),r.logging&&console.log("Replaced capitalized True/False/Null:",e),e=e.replace(/:\s*(?!true\b|false\b|null\b)([a-zA-Z_][a-zA-Z0-9_]*)\s*([\}\],])/g,': "$1"$2'),r.logging&&console.log("Quoted unquoted string values:",e),e=e.replace(/:\s*([a-zA-Z0-9_]+)"([\}\],])/g,': "$1"$2'),r.logging&&console.log("Fixed missing opening quote for values:",e),e=N(e),r.logging&&console.log("Fixed broken string values:",e),e=j(e),r.logging&&console.log("Escaped inner unquoted double quotes:",e),r.safeMode||(e=k(e),r.logging&&console.log("Balanced brackets:",e)),e=v(e),r.logging&&console.log("Escaped control chars:",e);try{let t=JSON.parse(e);if(!r.returnObject){let s=JSON.stringify(t);return r.encodeAscii&&(s=s.replace(/[^\x00-\x7F]/g,i=>"\\u"+i.charCodeAt(0).toString(16).padStart(4,"0"))),s}return t}catch(t){r.logging&&console.warn("[json-repair] Repair failed:",t);let s=l.slice(0,100).replace(/\n/g," ").trim(),i="[json-repair] Failed to parse repaired JSON.",c=t instanceof Error?t.message:"Unknown parsing error",a=`${i} ${c} Input was: "${s}..."`;throw r.safeMode?new Error(i):new Error(a)}}}});var g=J(m()),{__esModule:C,extractJsonFromText:_,repairJson:E}=g,I=g.default??g;export{C as __esModule,I as default,_ as extractJsonFromText,E as repairJson};
